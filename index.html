<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ—¶å…‰é…¿é€ æ‰€ Â· ç”Ÿäº§çº§å…¨ç¦»å­æŒæ§å·¥ä½œå°</title>
  <style>
    :root {
      --bg-primary:    #0c0c18;
      --bg-secondary:  #13132a;
      --bg-card:       #1a1a35;
      --accent:        #d4a017;
      --accent-light:  #f0c040;
      --accent-dim:    rgba(212,160,23,0.12);
      --border:        rgba(212,160,23,0.18);
      --text-primary:  #ededf5;
      --text-secondary:#9090b8;
      --text-dim:      #505070;
      --success:       #10b981;
      --warning:       #f59e0b;
      --danger:        #ef4444;
      --blue:          #60a5fa;
      --purple:        #a78bfa;
      --green:         #34d399;
      --glow:          0 0 40px rgba(212,160,23,0.12);
    }
    *, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'PingFang SC', 'Microsoft YaHei', 'Segoe UI', sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
    }

    /* â”€â”€ HEADER â”€â”€ */
    .header {
      background: linear-gradient(135deg, #0c0c18 0%, #1a0c00 50%, #0c0c18 100%);
      border-bottom: 1px solid var(--border);
      padding: 18px 40px;
      display: flex; align-items: center; justify-content: space-between;
      position: sticky; top: 0; z-index: 100;
      backdrop-filter: blur(24px);
    }
    .logo { display:flex; align-items:center; gap:14px; }
    .logo-icon {
      width:46px; height:46px; border-radius:12px;
      background: linear-gradient(135deg, var(--accent) 0%, #8a5c00 100%);
      display:flex; align-items:center; justify-content:center; font-size:22px;
    }
    .logo-text h1 { font-size:19px; font-weight:800; color:var(--accent); letter-spacing:.06em; }
    .logo-text p  { font-size:11px; color:var(--text-secondary); letter-spacing:.12em; margin-top:2px; }
    .header-badges { display:flex; gap:10px; align-items:center; }
    .badge {
      display:flex; align-items:center; gap:6px;
      background:var(--accent-dim); border:1px solid var(--border); border-radius:20px;
      padding:5px 14px; font-size:11px; color:var(--accent); letter-spacing:.05em;
    }
    .dot { width:7px; height:7px; border-radius:50%; background:var(--success); animation:pulse 2s infinite; }
    @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:.4} }
    .nav { display:flex; gap:6px; align-items:center; }
    .nav a { padding:5px 12px; border-radius:7px; font-size:12px; font-weight:600;
      text-decoration:none; color:var(--text-secondary); border:1px solid transparent; transition:all .2s; }
    .nav a:hover { color:var(--accent); border-color:var(--border); }
    .nav a.active { color:var(--bg-primary); background:var(--accent); border-color:var(--accent); }
    .nav a.dim { opacity:.35; pointer-events:none; }

    /* â”€â”€ MAIN â”€â”€ */
    .main { max-width:1380px; margin:0 auto; padding:28px 24px 60px; }

    /* â”€â”€ CARDS â”€â”€ */
    .card {
      background: var(--bg-card); border:1px solid var(--border); border-radius:18px;
      padding:26px; margin-bottom:22px;
      transition: border-color .2s, box-shadow .2s;
    }
    .card:hover { border-color:rgba(212,160,23,.35); box-shadow:var(--glow); }

    /* â”€â”€ SECTION TITLE â”€â”€ */
    .sec-title { display:flex; align-items:center; gap:12px; margin-bottom:20px; }
    .sec-icon {
      width:36px; height:36px; border-radius:10px;
      background:var(--accent-dim); border:1px solid var(--border);
      display:flex; align-items:center; justify-content:center; font-size:17px; flex-shrink:0;
    }
    .sec-title h2 { font-size:17px; font-weight:700; }
    .sec-title span { font-size:12px; color:var(--text-secondary); margin-left:8px; }

    /* â”€â”€ STYLE GRID â”€â”€ */
    .style-scroll { overflow-x:auto; padding-bottom:8px; margin-bottom:18px; }
    .style-grid { display:flex; gap:10px; min-width:max-content; }
    .style-card {
      background:var(--bg-secondary); border:1px solid rgba(255,255,255,.06);
      border-radius:14px; padding:12px 14px; cursor:pointer;
      transition:all .2s; text-align:center; width:120px; flex-shrink:0;
    }
    .style-card:hover { border-color:var(--accent); background:var(--accent-dim); }
    .style-card.active {
      border-color:var(--accent); background:var(--accent-dim);
      box-shadow:0 0 14px rgba(212,160,23,.25);
    }
    .style-card .s-emoji { font-size:22px; margin-bottom:5px; }
    .style-card .s-name  { font-size:11px; font-weight:700; color:var(--text-primary); line-height:1.3; }
    .style-card .s-en    { font-size:9px; color:var(--text-dim); margin-top:2px; }

    /* â”€â”€ STYLE DETAIL â”€â”€ */
    .style-detail {
      background:var(--bg-secondary); border:1px solid rgba(212,160,23,.15);
      border-radius:14px; padding:20px;
    }
    .style-detail-head { display:flex; align-items:flex-start; gap:14px; margin-bottom:18px; }
    .style-detail-head .big-emoji { font-size:36px; line-height:1; }
    .style-detail-head .title   { font-size:20px; font-weight:800; color:var(--accent); }
    .style-detail-head .en-name { font-size:13px; color:var(--text-secondary); margin-top:2px; }
    .style-detail-head .desc    { font-size:12px; color:var(--text-dim); margin-top:4px; line-height:1.6; }
    .style-ion-grid { display:grid; grid-template-columns:repeat(4,1fr); gap:14px; }
    @media(max-width:700px){ .style-ion-grid{grid-template-columns:repeat(2,1fr);} }
    .style-ion-item { display:flex; flex-direction:column; gap:6px; }
    .style-ion-label { font-size:11px; font-weight:600; color:var(--text-secondary); }
    .style-ion-range { font-size:10px; color:var(--accent); }
    .range-track {
      height:7px; background:rgba(255,255,255,.07); border-radius:4px;
      position:relative; overflow:visible;
    }
    .range-fill { position:absolute; top:0; height:100%; background:rgba(212,160,23,.3); border-radius:4px; }
    .range-dot {
      position:absolute; top:50%; transform:translate(-50%,-50%);
      width:11px; height:11px; background:var(--accent); border-radius:50%;
      box-shadow:0 0 6px rgba(212,160,23,.5);
    }
    .style-ion-target { font-size:11px; color:var(--text-dim); }
    .style-ion-target span { color:var(--accent-light); font-weight:700; }

    /* â”€â”€ LAYOUT GRIDS â”€â”€ */
    .grid-2 { display:grid; grid-template-columns:1fr 1fr; gap:22px; }
    .grid-3 { display:grid; grid-template-columns:1fr 1fr 1fr; gap:20px; }
    @media(max-width:900px){ .grid-2{grid-template-columns:1fr;} .grid-3{grid-template-columns:1fr;} }

    /* â”€â”€ FORM â”€â”€ */
    .form-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(140px,1fr)); gap:16px; }
    .form-group { display:flex; flex-direction:column; gap:6px; }
    .form-label {
      font-size:11.5px; color:var(--text-secondary); font-weight:600;
      display:flex; align-items:center; gap:5px; letter-spacing:.02em;
    }
    .form-input {
      background:var(--bg-secondary); border:1px solid rgba(255,255,255,.09);
      border-radius:10px; padding:11px 13px;
      color:var(--text-primary); font-size:17px; font-weight:700;
      outline:none; width:100%; transition:all .2s;
      font-family: inherit;
    }
    .form-input:focus { border-color:var(--accent); box-shadow:0 0 0 3px rgba(212,160,23,.1); }
    .form-input:disabled { opacity:.5; cursor:not-allowed; }
    .form-unit { font-size:10px; color:var(--text-dim); }
    .form-unit.accent { color:var(--accent); }

    /* â”€â”€ VOLUME DISPLAY â”€â”€ */
    .vol-display { display:flex; flex-direction:column; gap:10px; margin-top:18px; }
    .vol-box { border-radius:12px; padding:14px; text-align:center; }
    .vol-box.total  { background:rgba(212,160,23,.1);  border:1px solid rgba(212,160,23,.3); }
    .vol-box.mash   { background:rgba(96,165,250,.08); border:1px solid rgba(96,165,250,.2); }
    .vol-box.sparge { background:rgba(167,139,250,.08);border:1px solid rgba(167,139,250,.2); }
    .vol-row-split  { display:grid; grid-template-columns:1fr 1fr; gap:10px; }
    .vol-box .v-label { font-size:10px; letter-spacing:.1em; text-transform:uppercase; margin-bottom:5px; }
    .vol-box.total  .v-label { color:var(--accent); }
    .vol-box.mash   .v-label { color:#60a5fa; }
    .vol-box.sparge .v-label { color:#a78bfa; }
    .vol-box .v-num  { font-size:30px; font-weight:800; line-height:1; }
    .vol-box.total .v-num { font-size:26px; color:var(--accent); }
    .vol-box .v-unit { font-size:11px; color:var(--text-secondary); margin-top:3px; }
    .vol-formula {
      font-size:11px; color:var(--text-dim); text-align:center; line-height:1.8;
    }
    .vol-formula .hi { color:var(--accent); font-weight:700; }

    /* â”€â”€ PRESET BUTTONS â”€â”€ */
    .presets { display:flex; gap:8px; flex-wrap:wrap; margin-bottom:16px; }
    .preset-btn {
      padding:5px 14px; background:var(--bg-secondary);
      border:1px solid rgba(255,255,255,.08); border-radius:18px;
      color:var(--text-secondary); font-size:12px; cursor:pointer; transition:all .2s;
      font-family:inherit;
    }
    .preset-btn:hover { border-color:var(--accent); color:var(--accent); }

    /* â”€â”€ TOGGLE GROUP â”€â”€ */
    .toggle-group { display:flex; background:var(--bg-secondary); border-radius:10px; padding:3px; }
    .toggle-btn {
      flex:1; padding:7px 16px; border:none; background:transparent;
      color:var(--text-secondary); border-radius:8px; font-size:12px;
      cursor:pointer; transition:all .2s; font-family:inherit; white-space:nowrap;
    }
    .toggle-btn.active { background:var(--accent); color:#0c0c18; font-weight:700; }

    /* â”€â”€ DIVIDER â”€â”€ */
    .divider { height:1px; background:var(--border); margin:18px 0; }

    /* â”€â”€ SALT RESULT CARDS â”€â”€ */
    .salt-card {
      background:var(--bg-secondary); border:1px solid rgba(255,255,255,.07);
      border-radius:18px; padding:22px; text-align:center; position:relative; overflow:hidden;
      transition:all .3s;
    }
    .salt-card::after {
      content:''; position:absolute; top:0; left:0; right:0; height:3px;
      background:linear-gradient(90deg, var(--c) 0%, transparent 100%);
    }
    .salt-card.gypsum { --c: #60a5fa; }
    .salt-card.cacl2  { --c: #a78bfa; }
    .salt-card.epsom  { --c: #34d399; }
    .salt-icon {
      width:50px; height:50px; border-radius:14px; font-size:24px;
      display:flex; align-items:center; justify-content:center; margin:0 auto 10px;
    }
    .gypsum .salt-icon { background:rgba(96,165,250,.12); }
    .cacl2  .salt-icon { background:rgba(167,139,250,.12); }
    .epsom  .salt-icon { background:rgba(52,211,153,.12); }
    .salt-name    { font-size:15px; font-weight:800; margin-bottom:3px; }
    .salt-formula { font-size:11px; color:var(--text-dim); font-family:'Courier New',monospace; margin-bottom:14px; }
    .salt-total   { font-size:42px; font-weight:900; color:var(--accent); line-height:1; }
    .salt-total-unit { font-size:13px; color:var(--text-secondary); margin:3px 0 18px; }
    .salt-contributions { display:flex; gap:6px; justify-content:center; margin-bottom:14px; flex-wrap:wrap; }
    .contrib-tag { font-size:9px; padding:2px 8px; border-radius:10px; background:rgba(255,255,255,.06); color:var(--text-secondary); }
    .salt-split {
      display:grid; grid-template-columns:1fr 1fr; gap:10px;
      background:rgba(0,0,0,.2); border-radius:12px; padding:12px;
    }
    .split-item .s-label { font-size:9px; color:var(--text-dim); text-transform:uppercase; letter-spacing:.08em; margin-bottom:4px; }
    .split-item .s-val   { font-size:20px; font-weight:800; }
    .split-item .s-unit  { font-size:10px; color:var(--text-secondary); }

    /* â”€â”€ QUALITY CONTROL â”€â”€ */
    .qc-grid { display:grid; grid-template-columns:1fr 1fr; gap:18px; }
    @media(max-width:700px){ .qc-grid{grid-template-columns:1fr;} }
    .qc-box {
      background:var(--bg-secondary); border:1px solid rgba(255,255,255,.06);
      border-radius:14px; padding:20px;
    }
    .qc-label { font-size:11px; text-transform:uppercase; letter-spacing:.1em; color:var(--text-secondary); margin-bottom:14px; }
    .ratio-center { text-align:center; margin-bottom:12px; }
    .ratio-num  { font-size:38px; font-weight:900; }
    .ratio-desc { font-size:12px; color:var(--text-secondary); margin-top:2px; }
    .ratio-bar  {
      position:relative; height:12px;
      background:linear-gradient(90deg, #c2410c 0%, #92400e 30%, #d97706 50%, #65a30d 70%, #16a34a 100%);
      border-radius:6px; margin-bottom:8px;
    }
    .ratio-pin {
      position:absolute; top:50%; transform:translate(-50%,-50%);
      width:22px; height:22px; background:#fff; border-radius:50%;
      box-shadow:0 2px 10px rgba(0,0,0,.6); transition:left .35s ease;
    }
    .ratio-scale { display:flex; justify-content:space-between; font-size:10px; color:var(--text-dim); }
    .ca-center { text-align:center; margin-bottom:10px; }
    .ca-num    { font-size:36px; font-weight:900; transition:color .3s; }
    .ca-unit   { font-size:12px; color:var(--text-secondary); }
    .ca-status {
      display:inline-flex; align-items:center; gap:5px;
      padding:3px 12px; border-radius:16px; font-size:11px; font-weight:600; margin-top:6px;
    }
    .ca-status.good    { background:rgba(16,185,129,.12); color:var(--success); }
    .ca-status.warning { background:rgba(245,158,11,.12); color:var(--warning); }
    .ca-status.danger  { background:rgba(239,68,68,.12);  color:var(--danger); }
    .ca-bar {
      position:relative; height:10px; border-radius:5px; margin:10px 0 6px;
      background:linear-gradient(90deg, #ef4444 0%, #f59e0b 15%, #10b981 25%, #10b981 75%, #f59e0b 88%, #ef4444 100%);
    }
    .ca-pin {
      position:absolute; top:50%; transform:translate(-50%,-50%);
      width:18px; height:18px; background:#fff; border-radius:50%;
      box-shadow:0 2px 8px rgba(0,0,0,.5); transition:left .35s ease;
    }
    .ca-scale { display:flex; justify-content:space-between; font-size:9px; color:var(--text-dim); }

    /* â”€â”€ PROFILE BARS â”€â”€ */
    .profile-title { font-size:11px; text-transform:uppercase; letter-spacing:.1em; color:var(--text-secondary); margin:20px 0 14px; }
    .profile-row { display:grid; grid-template-columns:64px 1fr 80px; align-items:center; gap:14px; margin-bottom:12px; }
    .profile-ion { font-size:12px; font-weight:700; color:var(--text-secondary); }
    .p-track { height:8px; background:rgba(255,255,255,.07); border-radius:4px; position:relative; overflow:visible; }
    .p-fill  { height:100%; border-radius:4px; transition:width .4s ease; }
    .p-target-line { position:absolute; top:50%; transform:translate(-50%,-50%); width:2px; height:16px; border-radius:1px; transition:left .4s ease; }
    .profile-val { font-size:13px; font-weight:800; text-align:right; }
    .profile-diff { font-size:10px; }

    /* â”€â”€ PROCESS GUIDE â”€â”€ */
    .process-grid { display:grid; grid-template-columns:1fr 1fr; gap:20px; }
    @media(max-width:700px){ .process-grid{grid-template-columns:1fr;} }
    .process-step {
      background:var(--bg-secondary); border:1px solid rgba(255,255,255,.06);
      border-radius:14px; padding:20px; position:relative; overflow:hidden;
    }
    .process-step::before {
      content:''; position:absolute; top:0; left:0; right:0; height:2px;
      background:linear-gradient(90deg, var(--step-c) 0%, transparent 100%);
    }
    .step-1 { --step-c: #60a5fa; }
    .step-2 { --step-c: #a78bfa; }
    .step-num {
      position:absolute; top:16px; right:16px; width:30px; height:30px; border-radius:50%;
      background:var(--step-c); color:#0c0c18;
      display:flex; align-items:center; justify-content:center; font-size:15px; font-weight:900; opacity:.9;
    }
    .step-title { font-size:14px; font-weight:800; margin-bottom:6px; }
    .step-desc  { font-size:12px; color:var(--text-secondary); line-height:1.65; margin-bottom:14px; }
    .step-salt-list { display:flex; flex-direction:column; gap:7px; }
    .step-salt-row {
      display:flex; justify-content:space-between; align-items:center;
      background:rgba(0,0,0,.2); border-radius:9px; padding:9px 13px;
    }
    .step-salt-row .ss-name { font-size:12px; color:var(--text-secondary); }
    .step-salt-row .ss-val  { font-size:15px; font-weight:800; color:var(--accent); }
    .step-water { margin-top:10px; font-size:11px; color:var(--text-dim); }
    .step-water span { color:var(--accent); font-weight:700; }

    /* â”€â”€ ALERTS â”€â”€ */
    .alert { display:flex; gap:10px; padding:11px 14px; border-radius:10px; font-size:12px; margin-top:12px; line-height:1.55; }
    .alert.info    { background:rgba(96,165,250,.08); border:1px solid rgba(96,165,250,.2); color:#93c5fd; }
    .alert.warning { background:rgba(245,158,11,.08); border:1px solid rgba(245,158,11,.2); color:#fbbf24; }
    .alert.danger  { background:rgba(239,68,68,.08);  border:1px solid rgba(239,68,68,.2);  color:#fca5a5; }
    #overageAlert { display:none; }

    /* â”€â”€ PRINT BUTTON â”€â”€ */
    .print-btn {
      display:flex; align-items:center; gap:8px; padding:9px 20px;
      background:var(--accent-dim); border:1px solid var(--border); border-radius:10px;
      color:var(--accent); font-size:13px; font-weight:600; cursor:pointer; transition:all .2s; font-family:inherit;
    }
    .print-btn:hover { background:rgba(212,160,23,.22); }

    /* â”€â”€ FOOTER â”€â”€ */
    footer { text-align:center; padding:36px; font-size:11px; color:var(--text-dim); border-top:1px solid var(--border); margin-top:20px; }
    footer p+p { margin-top:5px; }

    ::-webkit-scrollbar { width:7px; height:7px; }
    ::-webkit-scrollbar-track { background:var(--bg-primary); }
    ::-webkit-scrollbar-thumb { background:rgba(212,160,23,.25); border-radius:4px; }

    @keyframes saltPulse { 0%{box-shadow:0 0 0 rgba(212,160,23,0)} 40%{box-shadow:0 0 20px rgba(212,160,23,.35)} 100%{box-shadow:0 0 0 rgba(212,160,23,0)} }
    .updated { animation: saltPulse .5s ease; }

    @media print {
      .header { position:static; }
      body { background:#fff; color:#000; }
      .card, .style-detail, .qc-box, .process-step { border:1px solid #ccc; background:#fff; }
      .print-btn, .preset-btn { display:none; }
    }
  </style>
</head>
<body>

<header class="header">
  <div class="logo">
    <div class="logo-icon">ğŸº</div>
    <div class="logo-text">
      <h1>æ—¶å…‰é…¿é€ æ‰€</h1>
      <p>SHIGUANG BREWING Â· PRODUCTION ION CONTROL STATION</p>
    </div>
  </div>
  <div style="display:flex;gap:14px;align-items:center">
    <nav class="nav">
      <a href="recipe.html">ğŸ“‹ é…æ–¹</a>
      <a class="active">ğŸ’§ è°ƒæ°´</a>
      <a href="brew-day.html">ğŸº é…¿é€ æ—¥</a>
      <a class="dim">ğŸ“ˆ å‘é…µ</a>
    </nav>
    <button class="print-btn" onclick="window.print()">ğŸ–¨ æ‰“å°</button>
  </div>
</header>

<div class="main">

  <!-- 1. STYLE DASHBOARD -->
  <div class="card">
    <div class="sec-title">
      <div class="sec-icon">ğŸ¯</div>
      <div><h2>é£æ ¼ä»ªè¡¨ç›˜ <span>Style Dashboard Â· 25ç§ç»å…¸é£æ ¼å†…ç½®</span></h2></div>
    </div>
    <div class="style-scroll">
      <div class="style-grid" id="styleGrid"></div>
    </div>
    <div class="style-detail" id="styleDetail"></div>
  </div>

  <!-- 2. WATER SETUP + SOURCE WATER -->
  <div class="grid-2">

    <div class="card">
      <div class="sec-title">
        <div class="sec-icon">âš—ï¸</div>
        <div><h2>ç”Ÿäº§æ°´é‡é…ç½® <span>Process Volume Setup</span></h2></div>
      </div>
      <div class="form-grid">
        <div class="form-group">
          <label class="form-label">ğŸº è¿›ç½ç›®æ ‡é‡</label>
          <input type="number" class="form-input" id="fermenterVol" value="150" min="1" max="5000">
          <div class="form-unit">å‡ (L) Â· æœ€ç»ˆè¿›å‘é…µç½çš„éº¦æ±é‡</div>
        </div>
        <div class="form-group">
          <label class="form-label">ğŸ”¥ ç…®æ²¸è’¸å‘é‡</label>
          <input type="number" class="form-input" id="boilLoss" value="20" min="0" max="500">
          <div class="form-unit">å‡ (L) Â· ç…®æ²¸è¿‡ç¨‹è’¸å‘æŸè€—</div>
        </div>
        <div class="form-group">
          <label class="form-label">ğŸ’€ ç»¼åˆæŸè€—</label>
          <input type="number" class="form-input" id="otherLoss" value="10" min="0" max="200">
          <div class="form-unit">å‡ (L) Â· é…’ç³Ÿå¸æ°´ + ç®¡é“æ­»è§’ç­‰</div>
        </div>
        <div class="form-group">
          <label class="form-label">âš–ï¸ ç³–åŒ–æ°´å æ¯”</label>
          <input type="number" class="form-input" id="mashRatio" value="60" min="20" max="90">
          <div class="form-unit">% Â· å‰©ä½™ä¸ºæ´—ç³Ÿæ°´</div>
        </div>
      </div>

      <div class="vol-display">
        <div class="vol-box total">
          <div class="v-label">æ€»æŠ•æ°´é‡ Total Water Needed</div>
          <div class="v-num" id="totalVolNum">180.0</div>
          <div class="v-unit">å‡ (L)</div>
        </div>
        <div class="vol-formula">
          <span id="fFermenter" class="hi">150</span> è¿›ç½
          + <span id="fBoil" class="hi">20</span> è’¸å‘
          + <span id="fOther" class="hi">10</span> æŸè€—
          = <span id="fTotal" class="hi">180</span> L æ€»æŠ•æ°´
        </div>
        <div class="vol-row-split">
          <div class="vol-box mash">
            <div class="v-label">ç³–åŒ–é”… Mash</div>
            <div class="v-num" id="mashVolNum">108.0</div>
            <div class="v-unit">å‡ (L)</div>
          </div>
          <div class="vol-box sparge">
            <div class="v-label">æ´—ç³Ÿæ°´ HLT</div>
            <div class="v-num" id="spargeVolNum">72.0</div>
            <div class="v-unit">å‡ (L)</div>
          </div>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="sec-title">
        <div class="sec-icon">ğŸ’§</div>
        <div><h2>åŸºç¡€æ°´è´¨è¾“å…¥ <span>Source Water Profile</span></h2></div>
      </div>
      <div class="presets">
        <button class="preset-btn" onclick="setSourcePreset('ro')">ğŸ”µ çº¯ROæ°´ï¼ˆ0åŸºå‡†ï¼‰</button>
        <button class="preset-btn" onclick="setSourcePreset('soft')">ğŸ’§ è½¯æ°´</button>
        <button class="preset-btn" onclick="setSourcePreset('medium')">ğŸŒŠ ä¸­ç­‰æ°´</button>
        <button class="preset-btn" onclick="setSourcePreset('hard')">ğŸª¨ ç¡¬æ°´</button>
      </div>
      <div class="form-grid">
        <div class="form-group">
          <label class="form-label">CaÂ²âº é’™</label>
          <input type="number" class="form-input" id="srcCa" value="0" min="0">
          <div class="form-unit">ppm (mg/L)</div>
        </div>
        <div class="form-group">
          <label class="form-label">MgÂ²âº é•</label>
          <input type="number" class="form-input" id="srcMg" value="0" min="0">
          <div class="form-unit">ppm</div>
        </div>
        <div class="form-group">
          <label class="form-label">Clâ» æ°¯</label>
          <input type="number" class="form-input" id="srcCl" value="0" min="0">
          <div class="form-unit">ppm</div>
        </div>
        <div class="form-group">
          <label class="form-label">SOâ‚„Â²â» ç¡«é…¸æ ¹</label>
          <input type="number" class="form-input" id="srcSO4" value="0" min="0">
          <div class="form-unit">ppm</div>
        </div>
      </div>
      <div class="alert warning" id="overageAlert">
        âš ï¸ åŸºç¡€æ°´è´¨ä¸­éƒ¨åˆ†ç¦»å­å·²è¶…è¿‡ç›®æ ‡å€¼ï¼Œæ— æ³•é€šè¿‡åŠ ç›é™ä½ï¼ˆéœ€ç”¨ROæ°´ç¨€é‡Šï¼‰ã€‚å·²è‡ªåŠ¨è®¾ä¸º0åŠ é‡ã€‚
      </div>
    </div>
  </div>

  <!-- 3. TARGET IONS -->
  <div class="card">
    <div class="sec-title">
      <div class="sec-icon">ğŸ›ï¸</div>
      <div><h2>ç›®æ ‡ç¦»å­æµ“åº¦ <span>Target Ion Profile Â· PPM çº§å¾®è°ƒ</span></h2></div>
      <div style="margin-left:auto">
        <div class="toggle-group">
          <button class="toggle-btn active" id="btnStyle"  onclick="setTargetMode('style')">é£æ ¼è‡ªåŠ¨</button>
          <button class="toggle-btn"        id="btnManual" onclick="setTargetMode('manual')">æ‰‹åŠ¨ç²¾è°ƒ</button>
        </div>
      </div>
    </div>
    <div class="form-grid" id="targetGrid">
      <div class="form-group">
        <label class="form-label">CaÂ²âº é’™ <span style="color:var(--text-dim);font-weight:400">(å…³è”äº§ç‰©)</span></label>
        <input type="number" class="form-input" id="tgtCa" value="100" min="0" disabled>
        <div class="form-unit accent">å‚è€ƒèŒƒå›´ï¼š50â€“150 ppm</div>
      </div>
      <div class="form-group">
        <label class="form-label">MgÂ²âº é•</label>
        <input type="number" class="form-input" id="tgtMg" value="8" min="0" disabled>
        <div class="form-unit accent">å‚è€ƒèŒƒå›´ï¼š5â€“25 ppm</div>
      </div>
      <div class="form-group">
        <label class="form-label">Clâ» æ°¯</label>
        <input type="number" class="form-input" id="tgtCl" value="50" min="0" disabled>
        <div class="form-unit accent">è¶Šé«˜ â†’ éº¦èŠ½åœ†æ¶¦æ„Ÿè¶Šå¼º</div>
      </div>
      <div class="form-group">
        <label class="form-label">SOâ‚„Â²â» ç¡«é…¸æ ¹</label>
        <input type="number" class="form-input" id="tgtSO4" value="200" min="0" disabled>
        <div class="form-unit accent">è¶Šé«˜ â†’ é…’èŠ±è‹¦çˆ½æ„Ÿè¶Šå¼º</div>
      </div>
    </div>
    <div class="alert info" id="targetModeNote">
      ğŸ’¡ é£æ ¼è‡ªåŠ¨æ¨¡å¼ï¼šç›®æ ‡å€¼å·²ä»é€‰å®šé£æ ¼è‡ªåŠ¨è½½å…¥ã€‚åˆ‡æ¢ã€Œæ‰‹åŠ¨ç²¾è°ƒã€å¯è‡ªç”±ä¿®æ”¹ä»»æ„ç¦»å­ç›®æ ‡å€¼ã€‚
    </div>
  </div>

  <!-- 4. RESULTS -->
  <div class="card">
    <div class="sec-title">
      <div class="sec-icon">âš–ï¸</div>
      <div><h2>åŠ ç›é‡è®¡ç®—ç»“æœ <span>Salt Addition Results Â· å…¨æ‰¹æ¬¡ + ä¸¤é˜¶æ®µå·¥è‰ºæ‹†åˆ†</span></h2></div>
    </div>
    <div class="grid-3">
      <div class="salt-card gypsum" id="cardGypsum">
        <div class="salt-icon">ğŸ”µ</div>
        <div class="salt-name">çŸ³è†</div>
        <div class="salt-formula">CaSOâ‚„ Â· 2Hâ‚‚O</div>
        <div class="salt-total" id="gypsumTotal">0.0</div>
        <div class="salt-total-unit">å…‹ï¼ˆå…¨æ‰¹æ¬¡æ€»æŠ•æ–™ï¼‰</div>
        <div class="salt-contributions">
          <span class="contrib-tag">â†’ CaÂ²âº +</span>
          <span class="contrib-tag">â†’ SOâ‚„Â²â» +</span>
        </div>
        <div class="salt-split">
          <div class="split-item">
            <div class="s-label">ç³–åŒ–é”…</div>
            <div class="s-val" id="gypsumMash">0.0</div>
            <div class="s-unit">g</div>
          </div>
          <div class="split-item">
            <div class="s-label">æ´—ç³Ÿæ°´</div>
            <div class="s-val" id="gypsumSparge">0.0</div>
            <div class="s-unit">g</div>
          </div>
        </div>
      </div>

      <div class="salt-card cacl2" id="cardCacl2">
        <div class="salt-icon">ğŸŸ£</div>
        <div class="salt-name">æ°¯åŒ–é’™</div>
        <div class="salt-formula">CaClâ‚‚ Â· 2Hâ‚‚O</div>
        <div class="salt-total" id="cacl2Total">0.0</div>
        <div class="salt-total-unit">å…‹ï¼ˆå…¨æ‰¹æ¬¡æ€»æŠ•æ–™ï¼‰</div>
        <div class="salt-contributions">
          <span class="contrib-tag">â†’ CaÂ²âº +</span>
          <span class="contrib-tag">â†’ Clâ» +</span>
        </div>
        <div class="salt-split">
          <div class="split-item">
            <div class="s-label">ç³–åŒ–é”…</div>
            <div class="s-val" id="cacl2Mash">0.0</div>
            <div class="s-unit">g</div>
          </div>
          <div class="split-item">
            <div class="s-label">æ´—ç³Ÿæ°´</div>
            <div class="s-val" id="cacl2Sparge">0.0</div>
            <div class="s-unit">g</div>
          </div>
        </div>
      </div>

      <div class="salt-card epsom" id="cardEpsom">
        <div class="salt-icon">ğŸŸ¢</div>
        <div class="salt-name">æ³»ç›</div>
        <div class="salt-formula">MgSOâ‚„ Â· 7Hâ‚‚O</div>
        <div class="salt-total" id="epsomTotal">0.0</div>
        <div class="salt-total-unit">å…‹ï¼ˆå…¨æ‰¹æ¬¡æ€»æŠ•æ–™ï¼‰</div>
        <div class="salt-contributions">
          <span class="contrib-tag">â†’ MgÂ²âº +</span>
          <span class="contrib-tag">â†’ SOâ‚„Â²â» +ï¼ˆè‡ªåŠ¨æ‰£å‡ï¼‰</span>
        </div>
        <div class="salt-split">
          <div class="split-item">
            <div class="s-label">ç³–åŒ–é”…</div>
            <div class="s-val" id="epsomMash">0.0</div>
            <div class="s-unit">g</div>
          </div>
          <div class="split-item">
            <div class="s-label">æ´—ç³Ÿæ°´</div>
            <div class="s-val" id="epsomSparge">0.0</div>
            <div class="s-unit">g</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 5. QUALITY CONTROL -->
  <div class="card">
    <div class="sec-title">
      <div class="sec-icon">ğŸ“Š</div>
      <div><h2>å®æ—¶å“è´¨ç›‘æ§ <span>Quality Control Â· é£å‘³æ–¹å‘ + ç¦»å­å¥åº·é¢„æµ‹</span></h2></div>
    </div>
    <div class="qc-grid">
      <div class="qc-box">
        <div class="qc-label">SOâ‚„Â²â» / Clâ» é£å‘³æ–¹å‘æ¯”</div>
        <div class="ratio-center">
          <div class="ratio-num" id="ratioNum">â€”</div>
          <div class="ratio-desc" id="ratioDesc">â€”</div>
        </div>
        <div class="ratio-bar">
          <div class="ratio-pin" id="ratioPin" style="left:50%"></div>
        </div>
        <div class="ratio-scale">
          <span>ğŸ¯ éº¦èŠ½åœ†æ¶¦ &lt;0.5</span>
          <span>âš–ï¸ å¹³è¡¡ ~1.0</span>
          <span>ğŸŒ¿ é…’èŠ±è‹¦çˆ½ &gt;2.0</span>
        </div>
      </div>
      <div class="qc-box">
        <div class="qc-label">é’™ç¦»å­é¢„æµ‹ç»“æœï¼ˆCaÂ²âº å…³è”äº§ç‰©ï¼‰</div>
        <div class="ca-center">
          <div class="ca-num" id="caNum">â€”</div>
          <div class="ca-unit">ppmï¼ˆé¢„è®¡æœ€ç»ˆæµ“åº¦ï¼‰</div>
          <div><span class="ca-status good" id="caStatus">â€” å¥åº·èŒƒå›´ â€”</span></div>
        </div>
        <div class="ca-bar">
          <div class="ca-pin" id="caPin" style="left:50%"></div>
        </div>
        <div class="ca-scale">
          <span>0</span><span>50</span><span>100</span><span>150</span><span>200+</span>
        </div>
      </div>
    </div>
    <div class="profile-title">ğŸ“ˆ é¢„è®¡æœ€ç»ˆç¦»å­æµ“åº¦ vs ç›®æ ‡å€¼å¯¹æ¯”</div>
    <div id="profileBars"></div>
  </div>

  <!-- 6. PROCESS GUIDE -->
  <div class="card">
    <div class="sec-title">
      <div class="sec-icon">ğŸ“‹</div>
      <div><h2>ç”Ÿäº§æ“ä½œæŒ‡å¼• <span>å¾·å¼ä¸¤é”…ä¸‰å™¨ Â· ä¸¤é˜¶æ®µæŠ•æ–™æ–¹æ¡ˆ</span></h2></div>
    </div>
    <div class="process-grid">
      <div class="process-step step-1">
        <div class="step-num">1</div>
        <div class="step-title">ç¬¬ä¸€é˜¶æ®µï¼šç³–åŒ–é”… (Mash Tun)</div>
        <div class="step-desc">æŠ•æ–™å‰ï¼Œå°†ä¸‹åˆ—ç›ç±»åŠ å…¥ç³–åŒ–çƒ­æ°´ä¸­ï¼Œå……åˆ†æ…æ‹Œè‡³å®Œå…¨æº¶è§£ã€‚å¾…æ°´æ¸©å‡åŒ€ç¨³å®šåå†æŠ•å…¥éº¦èŠ½ï¼Œå¼€å§‹ç³–åŒ–ã€‚</div>
        <div class="step-salt-list" id="mashGuide"></div>
        <div class="step-water">ç³–åŒ–ç”¨æ°´ï¼š<span id="mashVolGuide">â€”</span></div>
      </div>
      <div class="process-step step-2">
        <div class="step-num">2</div>
        <div class="step-title">ç¬¬äºŒé˜¶æ®µï¼šçƒ­æ°´ç½ (HLT Sparge)</div>
        <div class="step-desc">æ´—ç³Ÿå‰ï¼Œå°†ä¸‹åˆ—ç›ç±»åŠ å…¥çƒ­æ°´ç½ï¼ˆHLTï¼‰æ´—ç³Ÿæ°´ä¸­ï¼Œæ…æ‹Œå‡åŒ€ã€‚æŒ‰æ¯”ä¾‹æŠ•æ–™ç¡®ä¿å…¨æ‰¹æ¬¡æµ“åº¦å‰åä¸€è‡´ã€‚</div>
        <div class="step-salt-list" id="spargeGuide"></div>
        <div class="step-water">æ´—ç³Ÿç”¨æ°´ï¼š<span id="spargeVolGuide">â€”</span></div>
      </div>
    </div>
  </div>

</div>

<footer>
  <p>æ—¶å…‰é…¿é€ æ‰€ Â· Shiguang Brewing Co. &nbsp;|&nbsp; ç”Ÿäº§çº§å…¨ç¦»å­æŒæ§å·¥ä½œå° v1.1</p>
  <p>è®¡ç®—æ•°æ®åŸºäºæ ‡å‡†ç¦»å­è´¡çŒ®å€¼ï¼Œå®é™…æ•ˆæœå—æ°´æ¸©ã€pHã€è’¸å‘æŸè€—ç­‰å› ç´ å½±å“ï¼Œä»…ä¾›ä¸“ä¸šé…¿é€ å‚è€ƒã€‚</p>
</footer>

<script>
const STYLES = [
  { id:'west_coast_ipa', emoji:'ğŸŒŠ', name:'ç¾å¼è¥¿æµ·å²¸IPA', en:'West Coast IPA', desc:'é«˜ç¡«é…¸æ ¹é©±åŠ¨è‹¦çˆ½å£æ„Ÿï¼Œé…’èŠ±é¦™æ°”çªå‡ºï¼Œé…’ä½“æå¹²ã€‚ç»å…¸åŠ å·é£æ ¼ä»£è¡¨ã€‚', Ca:[75,120], Mg:[5,15], Cl:[30,80], SO4:[150,250], t:{ Ca:100, Mg:8, Cl:50, SO4:200 } },
  { id:'neipa', emoji:'â˜ï¸', name:'æµ‘æµŠIPA', en:'NEIPA / Hazy IPA', desc:'é«˜æ°¯å¡‘é€ æŸ”è½¯åœ†æ¶¦é…’ä½“ï¼Œæœé¦™æµ“éƒï¼Œè‹¦æ„Ÿè½»æŸ”ä¸æ»‘ã€‚æ–°è‹±æ ¼å…°ç‰¹è‰²ã€‚', Ca:[75,120], Mg:[5,15], Cl:[100,200], SO4:[50,100], t:{ Ca:100, Mg:10, Cl:150, SO4:60 } },
  { id:'czech_pils', emoji:'ğŸ‡¨ğŸ‡¿', name:'æ·å…‹çš®å°”æ£®', en:'Czech Pilsner', desc:'æ³¢è¥¿ç±³äºšè¶…è½¯æ°´ï¼Œéº¦èŠ½ä¸é…’èŠ±å¾®å¦™å¹³è¡¡ï¼Œæåº¦æ¸…çˆ½å¹²å‡€ã€‚', Ca:[20,40], Mg:[3,10], Cl:[10,25], SO4:[10,30], t:{ Ca:30, Mg:6, Cl:15, SO4:20 } },
  { id:'german_helles', emoji:'ğŸ‡©ğŸ‡ª', name:'å¾·å¼æ¸…äº®æ‹‰æ ¼', en:'German Helles', desc:'æ…•å°¼é»‘è½¯æ°´ï¼Œéº¦é¦™ä¸»å¯¼ï¼Œé…’èŠ±è½»æŸ”ç‚¹ç¼€ã€‚å¹²å‡€åœ†æ¶¦æ¸…çˆ½ã€‚', Ca:[40,70], Mg:[5,12], Cl:[30,55], SO4:[30,55], t:{ Ca:50, Mg:8, Cl:40, SO4:40 } },
  { id:'new_world_lager', emoji:'ğŸŒ', name:'æ–°ä¸–ç•Œæ‹‰æ ¼', en:'New World Lager', desc:'èåˆç°ä»£é…’èŠ±é¦™æ°”ä¸æ‹‰æ ¼æ¸…çˆ½ï¼ŒSOâ‚„/Clæ¯”ä¾‹ç²¾å‡†æ§åˆ¶å¹²çˆ½æ„Ÿã€‚', Ca:[50,80], Mg:[4,10], Cl:[30,50], SO4:[60,100], t:{ Ca:60, Mg:8, Cl:40, SO4:80 } },
  { id:'hefeweizen', emoji:'ğŸ‹', name:'å¾·å¼å°éº¦', en:'Hefeweizen', desc:'è¶…è½¯æ°´çªå‡ºé¦™è•‰ä¸é¦™é…µæ¯é£å‘³ï¼Œæ°´è´¨è½»æŸ”ä¸å¹²æ‰°å‘é…µç‰¹æ€§ã€‚', Ca:[40,70], Mg:[5,15], Cl:[20,45], SO4:[20,45], t:{ Ca:50, Mg:10, Cl:30, SO4:30 } },
  { id:'kolsch', emoji:'ğŸ™ï¸', name:'ç§‘éš†å•¤é…’', en:'KÃ¶lsch', desc:'æ¸…çˆ½å¹²å‡€ï¼Œæ‹‰æ ¼ä¸è‰¾å°”ä¹‹é—´ï¼Œæ°´è´¨è½»æŸ”ï¼Œé…’èŠ±æ¸…é¦™ã€‚ç§‘éš†ç‰¹äº§ã€‚', Ca:[40,70], Mg:[5,12], Cl:[25,45], SO4:[25,45], t:{ Ca:50, Mg:8, Cl:30, SO4:30 } },
  { id:'saison', emoji:'ğŸŒ¾', name:'æ¯”åˆ©æ—¶èµ›æ¾', en:'Belgian Saison', desc:'æœé…¯é…šç±»ä¸ºä¸»ï¼Œç¡«é…¸æ ¹é€‚ä¸­å¼ºè°ƒå¹²çˆ½ï¼Œæ¸…çˆ½æ´»æ³¼è¾›è¾£ã€‚', Ca:[60,100], Mg:[5,15], Cl:[20,40], SO4:[60,100], t:{ Ca:75, Mg:8, Cl:25, SO4:75 } },
  { id:'english_bitter', emoji:'ğŸ´ó §ó ¢ó ¥ó ®ó §ó ¿', name:'è‹±å¼è‹¦å•¤', en:'English Bitter', desc:'é«˜é’™é«˜ç¡«çŸ¿ç‰©è´¨æ„Ÿå¼ºï¼Œè‹±å¼é…’èŠ±åœŸè´¨é¦™ï¼Œéº¦èŠ½è‹¦æ„Ÿå®Œç¾å¹³è¡¡ã€‚', Ca:[80,130], Mg:[10,20], Cl:[60,100], SO4:[100,200], t:{ Ca:100, Mg:15, Cl:75, SO4:150 } },
  { id:'american_pale', emoji:'ğŸ‡ºğŸ‡¸', name:'ç¾å¼æ·¡è‰²è‰¾å°”', en:'American Pale Ale', desc:'ç¾å›½å•¤é…’èŠ±ä¸»å¯¼ï¼Œé…’èŠ±é¦™æ°”æ¸…çˆ½ï¼Œéº¦èŠ½è½»ç”œï¼Œæ°´è´¨é€‚ä¸­ã€‚', Ca:[60,100], Mg:[5,10], Cl:[40,70], SO4:[80,130], t:{ Ca:75, Mg:5, Cl:50, SO4:100 } },
  { id:'dipa', emoji:'ğŸ’ª', name:'åŒæ–™IPA', en:'Double IPA', desc:'è¶…é«˜ç¡«é…¸æ ¹è¿½æ±‚æè‡´è‹¦çˆ½ï¼Œé…’èŠ±å±‚æ¬¡æå…¶å¤æ‚ï¼Œé…’ä½“é¥±æ»¡ã€‚', Ca:[90,130], Mg:[5,15], Cl:[50,100], SO4:[200,300], t:{ Ca:110, Mg:8, Cl:75, SO4:250 } },
  { id:'brut_ipa', emoji:'ğŸ¥‚', name:'Brut IPA', en:'Brut IPA', desc:'æå¹²çˆ½è¶…ä½ç»ˆç³–ï¼Œé«˜ç¡«é…¸æ ¹ï¼Œè‹¦æ„Ÿå°–é”å¦‚é¦™æ§Ÿå¹²çˆ½ã€‚', Ca:[80,120], Mg:[5,10], Cl:[30,60], SO4:[150,250], t:{ Ca:100, Mg:5, Cl:40, SO4:200 } },
  { id:'stout', emoji:'â¬›', name:'çˆ±å°”å…°ä¸–æ¶›', en:'Irish Stout', desc:'ä½ç¡«ä½æ°¯çªå‡ºçƒ¤éº¦èŠ½è‹¦æ„Ÿï¼Œéƒ½æŸæ—æ°´è´¨å­•è‚²çš„ä¸æ»‘å£æ„Ÿã€‚', Ca:[80,120], Mg:[10,20], Cl:[60,90], SO4:[40,80], t:{ Ca:100, Mg:15, Cl:75, SO4:60 } },
  { id:'milk_stout', emoji:'ğŸ¥›', name:'ç‰›å¥¶ä¸–æ¶›', en:'Milk Stout', desc:'ä¹³ç³–å¢åŠ ç”œæ„Ÿï¼Œé«˜æ°¯å¼ºåŒ–åœ†æ¶¦ä¸æ»‘ï¼Œçƒ¤éº¦èŠ½é¦™æ°”æµ“éƒã€‚', Ca:[75,110], Mg:[5,15], Cl:[100,150], SO4:[30,70], t:{ Ca:90, Mg:10, Cl:120, SO4:50 } },
  { id:'porter', emoji:'ğŸ”·', name:'è‹±å¼æ³¢ç‰¹', en:'English Porter', desc:'æ·±è‰²éº¦èŠ½å¸¦å¯å¯å’–å•¡é£å‘³ï¼Œç¡«é…¸æ ¹é€‚ä¸­ï¼Œå£æ„Ÿé¥±æ»¡å¤æ‚ã€‚', Ca:[80,120], Mg:[10,20], Cl:[60,90], SO4:[60,100], t:{ Ca:100, Mg:15, Cl:75, SO4:75 } },
  { id:'munich_dunkel', emoji:'ğŸ‚', name:'æ…•å°¼é»‘æ·±è‰²æ‹‰æ ¼', en:'Munich Dunkel', desc:'é¢åŒ…éº¦èŠ½ç”œé¦™ï¼Œè‹¦æ„Ÿè½»æŸ”ï¼Œé¢œè‰²æ·±æ²‰ï¼Œæ…•å°¼é»‘ç§‹å¤©çš„å‘³é“ã€‚', Ca:[60,90], Mg:[8,15], Cl:[40,70], SO4:[40,70], t:{ Ca:75, Mg:10, Cl:50, SO4:50 } },
  { id:'vienna_lager', emoji:'ğŸ‡¦ğŸ‡¹', name:'ç»´ä¹Ÿçº³æ‹‰æ ¼', en:'Vienna Lager', desc:'çƒ¤éº¦é¦™æµ“éƒï¼Œè‹¦æ„ŸæŸ”å’Œå¹³è¡¡ï¼Œæ‹‰æ ¼ä¸­çš„è´µæ—ã€‚ç»´ä¹Ÿçº³ä¼ ç»Ÿã€‚', Ca:[60,100], Mg:[8,15], Cl:[35,60], SO4:[50,80], t:{ Ca:75, Mg:10, Cl:40, SO4:60 } },
  { id:'tripel', emoji:'âœï¸', name:'æ¯”åˆ©æ—¶ä¸‰æ–™', en:'Belgian Tripel', desc:'é«˜é…’ç²¾æœé…¯æµ“éƒï¼Œé…’èŠ±è‹¦æ„Ÿé€‚ä¸­ï¼Œä¿®é“é™¢é£æ ¼å¹²çˆ½æ¸…é›…ã€‚', Ca:[60,100], Mg:[5,12], Cl:[20,40], SO4:[60,100], t:{ Ca:75, Mg:8, Cl:25, SO4:75 } },
  { id:'dubbel', emoji:'ğŸ‡', name:'æ¯”åˆ©æ—¶åŒæ–™', en:'Belgian Dubbel', desc:'æ·±è‰²æœå¹²é£å‘³ç•¥ç”œï¼Œè‹¦æ„Ÿè½»æŸ”ï¼Œä¿®é“é™¢ç»å…¸æ·±è‰²è‰¾å°”ã€‚', Ca:[60,100], Mg:[8,15], Cl:[40,70], SO4:[40,70], t:{ Ca:75, Mg:10, Cl:50, SO4:50 } },
  { id:'scottish_ale', emoji:'ğŸ´ó §ó ¢ó ³ó £ó ´ó ¿', name:'è‹æ ¼å…°è‰¾å°”', en:'Scottish Ale', desc:'éº¦èŠ½ç”œæ„Ÿä¸»å¯¼ï¼Œé…’èŠ±æè½»ï¼Œä½ç¡«å¼ºè°ƒéº¦èŠ½åœ†æ¶¦ï¼Œè‹æ ¼å…°ç‰¹è‰²ã€‚', Ca:[50,80], Mg:[8,15], Cl:[50,80], SO4:[25,50], t:{ Ca:60, Mg:10, Cl:60, SO4:30 } },
  { id:'wee_heavy', emoji:'ğŸ¥ƒ', name:'è‹æ ¼å…°çƒˆæ€§è‰¾å°”', en:'Wee Heavy', desc:'æåº¦éº¦èŠ½ç”œï¼Œé«˜æ°¯å¼ºåŒ–åœ†æ¶¦åšé‡ï¼Œè¶…ä½ç¡«å¼±åŒ–è‹¦æ„Ÿï¼Œé™ˆå¹´æ½œåŠ›å¼ºã€‚', Ca:[60,100], Mg:[8,15], Cl:[70,110], SO4:[20,50], t:{ Ca:75, Mg:12, Cl:90, SO4:35 } },
  { id:'barleywine', emoji:'ğŸ‘‘', name:'å¤§éº¦é…’', en:'Barleywine', desc:'é«˜æµ“åº¦éº¦èŠ½é…’ï¼Œé…’ä½“åšé‡ï¼Œé™ˆå¹´åé¦™æ°”å¤æ‚ï¼Œæ°´è´¨é€‚ä¸­ä¸­æ€§ã€‚', Ca:[80,120], Mg:[8,15], Cl:[60,100], SO4:[80,130], t:{ Ca:100, Mg:10, Cl:75, SO4:100 } },
  { id:'berliner', emoji:'ğŸ«§', name:'æŸæ—ç™½å•¤', en:'Berliner Weisse', desc:'æä½çŸ¿ç‰©è´¨çªå‡ºä¹³é…¸é…¸æ„Ÿï¼Œå£æ„Ÿè½»ç›ˆæ¸…çˆ½ï¼ŒæŸæ—ä¼ ç»Ÿä½é…’ç²¾ã€‚', Ca:[20,50], Mg:[3,8], Cl:[10,30], SO4:[10,30], t:{ Ca:30, Mg:5, Cl:20, SO4:20 } },
  { id:'fruited_sour', emoji:'ğŸ“', name:'æ°´æœé…¸å•¤', en:'Fruited Sour', desc:'é…¸çˆ½æœé¦™ä¸ºä¸»ï¼Œè½¯æ°´é¿å…çŸ¿ç‰©æ„Ÿå¹²æ‰°ï¼Œçªå‡ºæ°´æœé£å‘³ã€‚', Ca:[30,60], Mg:[3,10], Cl:[20,50], SO4:[20,50], t:{ Ca:40, Mg:5, Cl:30, SO4:30 } },
  { id:'american_stout', emoji:'ğŸŒ‘', name:'ç¾å¼ä¸–æ¶›', en:'American Stout', desc:'æ¯”è‹±å¼æ›´å¤šé…’èŠ±ï¼Œçƒ¤éº¦ä¸é…’èŠ±è‹¦æ„Ÿå¹¶é‡ï¼Œå£æ„Ÿåšå®å±‚æ¬¡ä¸°å¯Œã€‚', Ca:[60,100], Mg:[8,15], Cl:[60,90], SO4:[80,130], t:{ Ca:75, Mg:10, Cl:75, SO4:100 } },
];

const CHEM = {
  gypsum: { Ca:232.8, SO4:558.0 },
  cacl2:  { Ca:272.6, Cl: 482.3 },
  epsom:  { Mg: 98.6, SO4:389.7 },
};

const S = {
  styleId:      'west_coast_ipa',
  mode:         'style',
  fermenterVol: 150,
  boilLoss:     20,
  otherLoss:    10,
  mashRatio:    60,
  src: { Ca:0, Mg:0, Cl:0, SO4:0 },
  tgt: { Ca:100, Mg:8, Cl:50, SO4:200 },
};

function getVolumes() {
  const total    = S.fermenterVol + S.boilLoss + S.otherLoss;
  const mashVol  = total * (S.mashRatio / 100);
  const spargeVol= total - mashVol;
  return { total, mashVol, spargeVol };
}

function calc() {
  const { total:volume, mashVol, spargeVol } = getVolumes();
  const { src, tgt } = S;

  const dMg  = Math.max(0, tgt.Mg  - src.Mg);
  const dCl  = Math.max(0, tgt.Cl  - src.Cl);
  const dSO4 = Math.max(0, tgt.SO4 - src.SO4);

  const epsomGpL     = dMg / CHEM.epsom.Mg;
  const so4FromEpsom = epsomGpL * CHEM.epsom.SO4;
  const cacl2GpL     = dCl / CHEM.cacl2.Cl;
  const remSO4       = Math.max(0, dSO4 - so4FromEpsom);
  const gypsumGpL    = remSO4 / CHEM.gypsum.SO4;

  const caFromSalts = gypsumGpL * CHEM.gypsum.Ca + cacl2GpL * CHEM.cacl2.Ca;
  const gypsumTot   = gypsumGpL * volume;
  const cacl2Tot    = cacl2GpL  * volume;
  const epsomTot    = epsomGpL  * volume;
  const mashFrac    = mashVol   / volume;
  const spargeFrac  = spargeVol / volume;

  const finalCa  = src.Ca  + caFromSalts;
  const finalMg  = src.Mg  + epsomGpL * CHEM.epsom.Mg;
  const finalCl  = src.Cl  + cacl2GpL * CHEM.cacl2.Cl;
  const finalSO4 = src.SO4 + gypsumGpL * CHEM.gypsum.SO4 + epsomGpL * CHEM.epsom.SO4;
  const ratio    = finalCl > 0.1 ? finalSO4 / finalCl : (finalSO4 > 0 ? 99 : 1);
  const overage  = (src.Ca>tgt.Ca+5)||(src.Mg>tgt.Mg+2)||(src.Cl>tgt.Cl+5)||(src.SO4>tgt.SO4+5);

  return {
    volume, mashVol, spargeVol,
    gypsum:{ total:gypsumTot, mash:gypsumTot*mashFrac, sparge:gypsumTot*spargeFrac },
    cacl2: { total:cacl2Tot,  mash:cacl2Tot*mashFrac,  sparge:cacl2Tot*spargeFrac  },
    epsom: { total:epsomTot,  mash:epsomTot*mashFrac,  sparge:epsomTot*spargeFrac  },
    finalCa, finalMg, finalCl, finalSO4, ratio, overage,
  };
}

const fmt  = n => n.toFixed(1);
const fmtI = n => Math.round(n);
function set(id,v)  { document.getElementById(id).textContent = v; }
function setV(id,v) { document.getElementById(id).value = v; }
function pulse(el)  { el.classList.remove('updated'); void el.offsetWidth; el.classList.add('updated'); }

function updateUI() {
  const r = calc();
  const total = S.fermenterVol + S.boilLoss + S.otherLoss;

  set('totalVolNum',   fmt(total));
  set('mashVolNum',    fmt(r.mashVol));
  set('spargeVolNum',  fmt(r.spargeVol));
  set('mashVolGuide',  fmt(r.mashVol) + ' L');
  set('spargeVolGuide',fmt(r.spargeVol) + ' L');
  set('fFermenter', S.fermenterVol);
  set('fBoil',      S.boilLoss);
  set('fOther',     S.otherLoss);
  set('fTotal',     total);

  ['gypsum','cacl2','epsom'].forEach(s => {
    set(s+'Total',  fmt(r[s].total));
    set(s+'Mash',   fmt(r[s].mash));
    set(s+'Sparge', fmt(r[s].sparge));
    pulse(document.getElementById('card'+s.charAt(0).toUpperCase()+s.slice(1)));
  });

  const ratio = r.ratio;
  let ratioText, ratioPos;
  if      (ratio < 0.5) { ratioText='ğŸ¯ éº¦èŠ½ä¸»å¯¼ï¼ˆåœ†æ¶¦ç”œç¾ï¼‰';   ratioPos=8;  }
  else if (ratio < 0.8) { ratioText='åéº¦èŠ½ï¼ˆæŸ”å’Œåœ†æ¶¦ï¼‰';         ratioPos=25; }
  else if (ratio < 1.2) { ratioText='âš–ï¸ é…’èŠ±éº¦èŠ½å®Œç¾å¹³è¡¡';       ratioPos=45; }
  else if (ratio < 1.8) { ratioText='åé…’èŠ±ï¼ˆæ¸…çˆ½å¾®è‹¦ï¼‰';         ratioPos=60; }
  else if (ratio < 3.0) { ratioText='ğŸŒ¿ é…’èŠ±ä¸»å¯¼ï¼ˆå¹²çˆ½è‹¦å†½ï¼‰';   ratioPos=75; }
  else                  { ratioText='âš¡ æè‡´é…’èŠ±ï¼ˆé”‹èŠ’æ¯•éœ²ï¼‰';    ratioPos=92; }
  set('ratioNum',  ratio > 50 ? 'âˆ' : ratio.toFixed(2));
  set('ratioDesc', ratioText);
  document.getElementById('ratioPin').style.left = Math.max(5,Math.min(95,ratioPos)) + '%';

  const ca = r.finalCa;
  set('caNum', fmtI(ca));
  let caClass, caText, caColor;
  if      (ca < 30)  { caClass='danger';  caText='âš  è¿‡ä½(<30) é…µæ¯å¥åº·é£é™©';    caColor='#ef4444'; }
  else if (ca < 50)  { caClass='warning'; caText='âš¡ åä½(30â€“50) å»ºè®®é€‚é‡å¢åŠ '; caColor='#f59e0b'; }
  else if (ca <=150) { caClass='good';    caText='âœ“ å¥åº·èŒƒå›´ (50â€“150 ppm)';      caColor='#10b981'; }
  else if (ca <=200) { caClass='warning'; caText='âš¡ åé«˜(150â€“200) æ³¨æ„è‰é…¸é’™'; caColor='#f59e0b'; }
  else               { caClass='danger';  caText='âš  è¿‡é«˜(>200) å¯èƒ½å½±å“è‹¦æ„Ÿ';   caColor='#ef4444'; }
  document.getElementById('caNum').style.color = caColor;
  const caStat = document.getElementById('caStatus');
  caStat.className = 'ca-status ' + caClass;
  caStat.textContent = caText;
  document.getElementById('caPin').style.left = Math.max(3,Math.min(97,(ca/220)*100)) + '%';

  document.getElementById('overageAlert').style.display = r.overage ? 'flex' : 'none';
  renderProfileBars(r);
  renderProcessGuide(r);
}

function renderProfileBars(r) {
  const ions = [
    { label:'CaÂ²âº', val:r.finalCa,  tgt:S.tgt.Ca,  max:220, color:'#f59e0b' },
    { label:'MgÂ²âº', val:r.finalMg,  tgt:S.tgt.Mg,  max:50,  color:'#34d399' },
    { label:'Clâ»',  val:r.finalCl,  tgt:S.tgt.Cl,  max:260, color:'#a78bfa' },
    { label:'SOâ‚„Â²â»',val:r.finalSO4, tgt:S.tgt.SO4, max:350, color:'#60a5fa' },
  ];
  document.getElementById('profileBars').innerHTML = ions.map(ion => {
    const fillPct  = Math.min(100,(ion.val/ion.max)*100);
    const tgtPct   = Math.min(100,(ion.tgt/ion.max)*100);
    const diff     = ion.val - ion.tgt;
    const dc       = Math.abs(diff)<5?'#10b981':Math.abs(diff)<20?'#f59e0b':'#ef4444';
    return `<div class="profile-row">
      <div class="profile-ion">${ion.label}</div>
      <div class="p-track">
        <div class="p-fill" style="width:${fillPct}%;background:${ion.color};opacity:.75"></div>
        <div class="p-target-line" style="left:${tgtPct}%;background:${ion.color}"></div>
      </div>
      <div class="profile-val" style="color:${ion.color}">
        ${fmtI(ion.val)} <span class="profile-diff" style="color:${dc}">(${(diff>=0?'+':'')+fmtI(diff)})</span>
      </div>
    </div>`;
  }).join('');
}

function renderProcessGuide(r) {
  const names = { gypsum:'çŸ³è† (CaSOâ‚„Â·2Hâ‚‚O)', cacl2:'æ°¯åŒ–é’™ (CaClâ‚‚Â·2Hâ‚‚O)', epsom:'æ³»ç› (MgSOâ‚„Â·7Hâ‚‚O)' };
  ['mash','sparge'].forEach(stage => {
    document.getElementById(stage+'Guide').innerHTML =
      ['gypsum','cacl2','epsom'].map(salt =>
        `<div class="step-salt-row">
          <span class="ss-name">${names[salt]}</span>
          <span class="ss-val">${fmt(r[salt][stage])} g</span>
        </div>`).join('');
  });
}

function renderStyleGrid() {
  document.getElementById('styleGrid').innerHTML = STYLES.map(s =>
    `<div class="style-card${s.id===S.styleId?' active':''}" onclick="selectStyle('${s.id}')">
      <div class="s-emoji">${s.emoji}</div>
      <div class="s-name">${s.name}</div>
      <div class="s-en">${s.en}</div>
    </div>`).join('');
}

function renderStyleDetail(style) {
  const ions = [
    { label:'CaÂ²âº é’™',      range:style.Ca, tgt:style.t.Ca,  max:200 },
    { label:'MgÂ²âº é•',      range:style.Mg, tgt:style.t.Mg,  max:50  },
    { label:'Clâ» æ°¯',       range:style.Cl, tgt:style.t.Cl,  max:250 },
    { label:'SOâ‚„Â²â» ç¡«é…¸æ ¹', range:style.SO4,tgt:style.t.SO4, max:350 },
  ];
  document.getElementById('styleDetail').innerHTML = `
    <div class="style-detail-head">
      <div class="big-emoji">${style.emoji}</div>
      <div>
        <div class="title">${style.name}</div>
        <div class="en-name">${style.en}</div>
        <div class="desc">${style.desc}</div>
      </div>
    </div>
    <div class="style-ion-grid">
      ${ions.map(ion => {
        const minP=(ion.range[0]/ion.max)*100, maxP=(ion.range[1]/ion.max)*100, tgtP=(ion.tgt/ion.max)*100;
        return `<div class="style-ion-item">
          <div class="style-ion-label">${ion.label}</div>
          <div class="range-track">
            <div class="range-fill" style="left:${minP}%;width:${maxP-minP}%"></div>
            <div class="range-dot"  style="left:${tgtP}%"></div>
          </div>
          <div class="style-ion-range">${ion.range[0]}â€“${ion.range[1]} ppm</div>
          <div class="style-ion-target">æ¨èç›®æ ‡ï¼š<span>${ion.tgt} ppm</span></div>
        </div>`;
      }).join('')}
    </div>`;
}

function selectStyle(id) {
  S.styleId = id;
  const style = STYLES.find(s => s.id===id);
  if (!style) return;
  document.querySelectorAll('.style-card').forEach(el => el.classList.remove('active'));
  document.querySelector(`.style-card[onclick="selectStyle('${id}')"]`).classList.add('active');
  renderStyleDetail(style);
  if (S.mode==='style') { S.tgt={...style.t}; syncTargetInputs(); }
  updateUI();
}

function setTargetMode(mode) {
  S.mode = mode;
  document.getElementById('btnStyle').classList.toggle('active',  mode==='style');
  document.getElementById('btnManual').classList.toggle('active', mode==='manual');
  document.querySelectorAll('#targetGrid input').forEach(inp => { inp.disabled=(mode==='style'); });
  const note = document.getElementById('targetModeNote');
  if (mode==='style') {
    note.className='alert info';
    note.textContent='ğŸ’¡ é£æ ¼è‡ªåŠ¨æ¨¡å¼ï¼šç›®æ ‡å€¼å·²ä»é€‰å®šé£æ ¼è‡ªåŠ¨è½½å…¥ã€‚åˆ‡æ¢ã€Œæ‰‹åŠ¨ç²¾è°ƒã€å¯è‡ªç”±ä¿®æ”¹ä»»æ„ç¦»å­ç›®æ ‡å€¼ã€‚';
    const style=STYLES.find(s=>s.id===S.styleId);
    if (style) { S.tgt={...style.t}; syncTargetInputs(); }
  } else {
    note.className='alert warning';
    note.textContent='âœï¸ æ‰‹åŠ¨ç²¾è°ƒæ¨¡å¼ï¼šç›´æ¥è¾“å…¥ç›®æ ‡ç¦»å­ PPM å€¼ï¼Œç³»ç»Ÿå®æ—¶åå‘è®¡ç®—åŠ ç›é‡ã€‚CaÂ²âº ä¸ºå…³è”äº§ç‰©ï¼Œç”±åŠ ç›ç»“æœå†³å®šã€‚';
  }
  updateUI();
}

function syncTargetInputs() {
  setV('tgtCa',S.tgt.Ca); setV('tgtMg',S.tgt.Mg);
  setV('tgtCl',S.tgt.Cl); setV('tgtSO4',S.tgt.SO4);
}

function setSourcePreset(p) {
  const presets = {
    ro:    { Ca:0,   Mg:0,  Cl:0,  SO4:0  },
    soft:  { Ca:20,  Mg:3,  Cl:10, SO4:12 },
    medium:{ Ca:55,  Mg:8,  Cl:30, SO4:45 },
    hard:  { Ca:110, Mg:18, Cl:65, SO4:90 },
  };
  const d=presets[p]; if (!d) return;
  S.src={...d};
  setV('srcCa',d.Ca); setV('srcMg',d.Mg); setV('srcCl',d.Cl); setV('srcSO4',d.SO4);
  updateUI();
}

function bindInputs() {
  document.getElementById('fermenterVol').addEventListener('input', e => { S.fermenterVol=parseFloat(e.target.value)||1; updateUI(); });
  document.getElementById('boilLoss').addEventListener('input',     e => { S.boilLoss    =parseFloat(e.target.value)||0; updateUI(); });
  document.getElementById('otherLoss').addEventListener('input',    e => { S.otherLoss   =parseFloat(e.target.value)||0; updateUI(); });
  document.getElementById('mashRatio').addEventListener('input',    e => { S.mashRatio   =Math.min(90,Math.max(10,parseFloat(e.target.value)||60)); updateUI(); });
  ['Ca','Mg','Cl','SO4'].forEach(ion => {
    document.getElementById('src'+ion).addEventListener('input', e => { S.src[ion]=parseFloat(e.target.value)||0; updateUI(); });
    document.getElementById('tgt'+ion).addEventListener('input', e => { if(S.mode==='manual'){S.tgt[ion]=parseFloat(e.target.value)||0; updateUI();} });
  });
}

function init() {
  renderStyleGrid();
  const defStyle=STYLES.find(s=>s.id===S.styleId);
  if (defStyle) { S.tgt={...defStyle.t}; syncTargetInputs(); renderStyleDetail(defStyle); }
  document.querySelectorAll('#targetGrid input').forEach(inp=>{inp.disabled=true;});
  bindInputs();
  updateUI();
}

init();
</script>
</body>
</html>
